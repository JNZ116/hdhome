# 我家的作弊条汇总

## 初发点

懒！！！我要懒到底！！！

所有的产品要可以使用手机控制，必须支持安卓和苹果，但是一但稳定，我一定会关闭他们的云控制，因为我不信任任何一个云服务。所有的设备都要支持苹果HomeKit，通过Siri进行语音控制（老人和我这样的懒人必备），最终我会使用一台常在家中的iPad或AppleTV完成远程控制。以上只是个人这样的偏执者适用！ :)

原则上，我家中的设备要么支持HomeKit、要么支持HomeBridge、要么支持HomeAssistant，最差也要有想办法逆向协议自己DIY一个HomeAssistant插件的可能。好久好久没有写代码了，所以不知道自己写一个组件的时间要多久，一步一步来吧。

智能化的内容：

* 中央空调
* 灯（通过墙壁开关）
* 温度、湿度传感器
* 扫地机器人
* 视频监控
* 门锁
* 电子门铃
* 窗帘
* 热水循环
* 电暖、水暖
* 插座（床头、除湿机、热水循环、洗衣机、干衣机、管线饮水机）
* 万用脑洞开关（小米无线开关、老人小孩的好盆友）

## 控制中心

我家中的控制中心由两台设备组成，一台树莓派做家中的中央控制器，它上面运行HA和HB。一台iPad（我现在也同时在使用AppleTV）支持远程访问。我还在HA下特别配置了远程协助，可以通过苹果手机随时打开、关闭这个远程协助，在保证安全的情况下，可以远程（帮朋友）维护家中的系统和配置。

微型服务器（树莓派），淘宝上装好HA&HB的差不多600块，手掌大小没有声音。国内大部分设备都不支持HomeKit，所以需要这个来做中控接入到苹果家庭里。

## 中央空调

所有的中央空调都已经数字化控制了，以现在的情况来看，所有的中央空调厂商都使用了modbus协议做数字化控制。所以现在就有厂商认真的将modbus适配在各个不同的厂家转换成为TCP（RJ45）、485、KNX、433（射频）的协议。和中弘的聊了很久，他们的一体化modbus网关把各种协议都集成进去，同时还有网络和RF的模块，确实方便了很多。

### 使用中弘空调网关和HA直连方案

这个方案使用HA服务器连空调网关，即可实现homekit控制。中弘空调的HA组件在我的github中有，好处是非常稳定，缺点是只能苹果使用。另外，中弘空调网关只有网线，没有WiFi，所以需要做一个直连网线，把HA服务器和网关放在一起。

### 支持的中央空调机型

本人确认安装过的中央空调是大金，明确还支持的有格力、海尔、海信、日立、美的、三菱电机、三菱重工、东芝。

* 大金VRV接任意室内机F1和F2
* 日立接任意室内机1和2
* 三菱电机PUHY接任意室内机
* 美的接室外机
* 格力接室外机G1和G2

装修前期准备：看机型决定在室内机或者室外机引入室内的地方留插座。如果可以，在安装空调时请空调师傅把信号线引到插座边上。

说明：大金的施工非常不靠谱，品控极差，不建议使用。

## 绿米网关

我家领导的原因，晚上睡觉都会有一个夜灯，我个人非常喜欢听经济之声，所以这个网关在良好的HA与HB的协调以及还不错的价格下，成为了我的ZigBee网关。一个绿米网关2代现在价格应该150以内拿下。

## 墙壁开关

绿米网关加绿米单、双键开关，主要有几个因素，一是拿到开关后认为质量、美观和配置都不错。价格上一百多元一个，也可以接受。另外绿米新出了一个aqara home网关，直接支持homekit，对开关的支持还算是不错的。还要说明一下，一个三居室装修下来用20个开关是非常平常的事情，表被数量吓倒。不过大家要注意，绿米的开关质量真的不好说，使用一个多月下来，已经坏了三四个了。

装修前期准备：

* 所有的双开都不需要，有一个开关位置就好。这样会省很多开关的花费。比如你卧室，传统的方式是在门口和床边都装一个开关，有人在双人床两边各装一个，现在你只要门口一个就好，上床后对着siri喊就好了。
* 我喜欢的绿米开关只有单键和双键，所以你在装修时要和电工师傅说好，你最多只装双开，不要上三、四开这样的变态。
* 要向电工师傅确认你的开关是单火还是零火，不要买错了。

## 插座

绿米网关加绿米嵌入式墙壁插座还不错，一个插座一百多元，还带电量统计。到现在为止，aqara homekit网关还不支持86入墙插座，所以还是使用小米网关加HA解决加入homekit的方案吧。很多人想不明白什么地方应该使用智能插座，我可以这么说，当你走出家门时，内心呼唤着你要不要查查有没关的东西的插座就应该换为智能插座：

* 洗衣机
* 干衣机
* 电视机
* 热水管线机
* 除湿机
* 热水循环机
* 床头电子设备（电蚊香）

装修前期准备：

* 统计好插座，另外要认真考虑下什么插座用智能，什么不用。
* 确认插座是10A还是16A的，16A的插座三孔会更大些，一般接空调和电热水器
* 绿米插座是10A的，还没有16A的，要注意

## 温度湿度传感器

最终我选择了绿米的温湿度传感器，一个是便宜，再有就是相对来讲比较省电。

## 扫地机器人

各种奇葩的原因，我最终选择了石头扫地机器人，一方面它对HA和HB都有很好的接入，另一方面经济实惠、耗材也不错让我最终决定使用它。我家领导则是因为甄嬛语音，亲定了以后都用它了。

装修前期准备：

* 所有的家具都要有离地间隔，这样可以进去自动打扫，当然也可以没有缝隙
* 铺地毯的，要买够硬够强的，不然机器人和地毯有仇！

## 走廊监控

基本确定使用莹石C6TC 1080P，不到四百块，很便宜了好吗，而且可以通过rtsp取流到HA上，机器没到，但是已经确定的接口将来想做什么就做什么了。

装修前期准备：前后门外装摄像头，对应的地方留电源，能用网线接出去最好，这样比较稳定。

## 门锁

门锁我看了不少，最后在邻居朱天地的指引下一起团购了多灵P8苹果MFi认证的锁，有点小贵差不多四千大元。使用下来，使用还是很方便，唯一麻烦的问题是我的Apple TV距离有些远，蓝牙连不上，晚些估计还得在沙发边上扔一台iPad做中枢比较靠谱。


## 电子门铃

莹石DP1可以说是一个黑科技产品了，你可以做人员识别、到访记录、远程通话，再配合多灵P8开门，这个智能化直接让我们进入贞子出没的时代了。莹石的产品负责人跟我说他们的产品将会接入HA，这是唯一一个到现在不支持Homekit的产品，但是使用上要视频通话，所以也没想好支持了又能如何。

## 电动窗帘

我现在暂时还是决定使用绿米的窗帘机，它OEM杜亚的KT82机器，装上了zigbee的传感器，还没有做测试，如果有小白愿意，我可以免费帮忙测试。小米窗帘电机如果有500的特价，马上就去抢吧。轨道在马云家找60的kt82静音轨道就好，我是双层，一层纱帘一层遮阳帘。纱帘也可以使用手动轨道，三十几就可以拿下。如果你200一米小米官方店买，我只能认你是土豪了。aqara homekit网关已经对电动窗帘支持不错了，建议使用aqara网关。

装修前准备：电动窗帘在窗户的边上高位留电源即可，左右均可。

## 家庭网络

如果想做网络布线，建议五类线，至少支持千M吧。如果没做，建议上TP 1200M的电力猫（不用带wifi功能），一百多块，速度还不错。WiFi网络我最终使用的是

* 吸顶AP：IK-H3（400元）两台
* 路由器：IK-Q25（200元）一台
* 千兆16口交换机（200元）一台
* 千兆POE模块（50元）两台

这里几点注意，路由器是百兆的，如果你家200M光纤接入的，自己要舍得多花些钱买个千兆路由器。家里部署两台吸顶AP(POE供电)，美观大方、覆盖和并发都很好。另外，我所有的监控都是有线接入，所以使用了一个千兆多口交换机。

装修前期准备：

* 入户的弱电箱要大要大要很大，甚至我建议在弱电箱前放一个柜子，专门给你家的各种设备使用。
* 弱电箱边上留电源，接好排插，不然你会发现自己接出无数个排插
* 电视机后面不用留老的电视线路接口，每个电视后面至少两个网线接口，一个为IPTV使用，一个为上网使用

## 热水循环

了解了所有一千元以上的热水循环系统，有不少还带遥控。但是无法对接中央控制，最没有办法的方法是用电源控制，最后告诉我，通电后不会自动启动，必须人类去点下开关按钮。崩溃后发现可以直接使用它里面的循环泵。所以最终的方案就是一个智能插座加一个热水循环泵。我使用的是格兰富UPB15-6循环泵，接上智能插座完事。不到八百块的泵、不到两百块的插座，比一千九的省一半呢。

装修前期准备：给热水循环机准备电源。

## 电暖、水暖温控器

在快要崩溃的时候，github上有一位兄弟贡献了saswell温控器的代码，仔细一看，基本上是通过云来完成接入的，支持HA和homkit组件。

* SAS920WHL-7W-WIFI 水暖wifi温控器
* SAS920FHL-7W-WIFI 电暖wifi温控器

装修前准备：如果是换温控器，记得把线序记好

## 除湿机

淘宝上除湿机一大堆，我慢慢找，准备找个通电就工作的机器。

装修前期准备：记得为除湿机准备电源，我还为除湿机准备了排水。我是为除湿机安装了绿米插座，可以控制除湿机开关。

## 小米无线开关

大家有没有想过，当你用hi Siri时，老人、小孩不好用手机的家人怎么办？这里给你介绍一个好盆友：小米无线开关。其实早在很多年前，我就做出了这个产品，只是后来夭折，但是正是因为当初现在特别喜欢这个产品。它现在可以在米家和苹果家庭中设置好任何单击、双击、长按的触发动作。这样让手机上的操作再实体化，放到家里给老人和小孩子使用。比如：在家门口放两个，关联上进门的场景和出门的场景。你也可以用啊，因为你可能懒得开手机，也累的不想hi siri了。 :)


## 变更历史

2018.11.13 加入aqara homekit网关的部分
2018.6.7 插座的用途
2018.6.6 家里施工进展大半了，对所有以前的规划进行一个整理，真正实施的过程与之前所想有太多不同，感谢小区里的小白老蒋、发现homekit门锁的朱天地、帮我装好AP的锁钰。
